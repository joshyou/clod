<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compute Scaling Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-dragdata"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            color: #1a1a2e;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #0077b6, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 20px;
        }

        .controls-panel {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #0077b6;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 119, 182, 0.3);
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .control-label span:first-child {
            color: #444;
        }

        .control-value {
            color: #0077b6;
            font-weight: 600;
            font-family: 'Monaco', monospace;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #0077b6;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 119, 182, 0.3);
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #0077b6;
            cursor: pointer;
            border: none;
        }

        .charts-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .chart-container {
            background: #ffffff;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a2e;
        }

        .growth-badge {
            font-size: 0.75rem;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .chart-wrapper {
            position: relative;
            height: 220px;
        }

        .chart-wrapper.input-chart {
            height: 140px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .metric-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
        }

        .metric-dual {
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }

        .metric-year-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .metric-year {
            font-size: 0.65rem;
            color: #888;
            margin-bottom: 2px;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0077b6;
        }

        .metric-unit {
            font-size: 0.7rem;
            color: #888;
        }

        .reset-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(90deg, #7b2cbf, #0077b6);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 119, 182, 0.3);
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px 15px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .toggle-label {
            font-size: 0.85rem;
            color: #444;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e0e0e0;
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: #888;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: rgba(0, 119, 182, 0.3);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
            background-color: #0077b6;
        }

        .info-text {
            font-size: 0.75rem;
            color: #888;
            margin-top: 5px;
        }

        .param-pair {
            background: rgba(0, 119, 182, 0.03);
            border: 1px solid rgba(0, 119, 182, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .param-pair-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #444;
            margin-bottom: 4px;
        }

        .param-arrow {
            font-weight: 400;
            color: #888;
            font-size: 0.75rem;
            margin-left: 6px;
        }

        .param-pair-sliders {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .param-slider-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .param-slider-group input[type="range"] {
            width: 100%;
        }

        .param-slider-group .control-value {
            font-size: 0.8rem;
        }

        .param-pair-connector {
            color: #0077b6;
            font-weight: 600;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .stats-table-section {
            margin-top: 30px;
            background: #ffffff;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .stats-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .stats-table th,
        .stats-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .stats-table th {
            background: #f5f7fa;
            font-weight: 600;
            color: #444;
        }

        .stats-table th:not(:first-child),
        .stats-table td:not(:first-child) {
            text-align: right;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .stats-table td:first-child {
            color: #666;
        }

        .stats-table td:not(:first-child) {
            color: #0077b6;
            font-weight: 600;
        }

        .stats-table tbody tr:hover {
            background: rgba(0, 119, 182, 0.03);
        }

        .stats-table tbody tr:last-child td {
            border-bottom: none;
        }

        .input-charts-section {
            margin-bottom: 20px;
        }

        .input-charts-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .drag-hint {
            font-size: 0.75rem;
            font-weight: 400;
            color: #888;
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .input-charts-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .input-chart-container {
            background: #ffffff;
            border-radius: 10px;
            padding: 10px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            min-width: 0;
        }

        .input-chart-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .assumptions-section {
            margin-top: 30px;
            padding: 20px;
            background: #fafafa;
            border-radius: 12px;
            border: 1px solid #e8e8e8;
        }

        .assumptions-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 12px;
        }

        .assumptions-list {
            font-size: 0.8rem;
            color: #777;
            line-height: 1.7;
            margin: 0;
            padding-left: 20px;
        }

        .assumptions-list li {
            margin-bottom: 4px;
        }

        .assumptions-list strong {
            color: #555;
        }

        .custom-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-left: 8px;
            font-size: 0.7rem;
        }

        .custom-indicator span {
            background: #f59e0b;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .reset-custom-btn {
            background: #e5e7eb;
            border: none;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            cursor: pointer;
            color: #666;
        }

        .reset-custom-btn:hover {
            background: #d1d5db;
        }

        .section.custom-mode {
            opacity: 0.5;
            pointer-events: none;
            position: relative;
        }

        .section.custom-mode::after {
            content: 'Using custom values from chart';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(245, 158, 11, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            z-index: 10;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .input-charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Compute Scaling Simulator</h1>
        <p class="subtitle">Model frontier AI compute availability through 2035</p>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Largest Training Run (FLOP)</div>
                <div class="metric-dual">
                    <div class="metric-year-group">
                        <span class="metric-year">2030</span>
                        <span class="metric-value" id="metric-training-2030">-</span>
                    </div>
                    <div class="metric-year-group">
                        <span class="metric-year">2035</span>
                        <span class="metric-value" id="metric-training-2035">-</span>
                    </div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Training Cluster Cost</div>
                <div class="metric-dual">
                    <div class="metric-year-group">
                        <span class="metric-year">2030</span>
                        <span class="metric-value" id="metric-cluster-cost-2030">-</span>
                    </div>
                    <div class="metric-year-group">
                        <span class="metric-year">2035</span>
                        <span class="metric-value" id="metric-cluster-cost-2035">-</span>
                    </div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Total AI Power</div>
                <div class="metric-dual">
                    <div class="metric-year-group">
                        <span class="metric-year">2030</span>
                        <span class="metric-value" id="metric-power-2030">-</span>
                    </div>
                    <div class="metric-year-group">
                        <span class="metric-year">2035</span>
                        <span class="metric-value" id="metric-power-2035">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="controls-panel">
                <div class="section" id="capex-section">
                    <div class="section-title">1. Capex Growth</div>
                    <div class="info-text" style="margin-bottom: 10px;">Annual AI hardware spending worldwide</div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Growth Rate</span>
                            <span class="control-value" id="val-capex-growth">40%</span>
                        </div>
                        <input type="range" id="capex-growth" min="10" max="80" value="40" step="5">
                        <div class="info-text">Constant until cap is reached</div>
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Capex Cap (% of GDP)</span>
                            <span class="control-value" id="val-capex-gdp-percent">1%</span>
                        </div>
                        <input type="range" id="capex-gdp-percent" min="0.5" max="5" value="1" step="0.5">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>GDP Growth 2035</span>
                            <span class="control-value" id="val-gdp-growth-2035">3%</span>
                        </div>
                        <input type="range" id="gdp-growth-2035" min="1" max="30" value="3" step="0.5">
                        <div class="info-text">Interpolates from 3% in 2025</div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">2. Cost-Performance</div>
                    <div class="info-text" style="margin-bottom: 10px;">Compute per dollar improvement rate</div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Initial Improvement Rate</span>
                            <span class="control-value" id="val-cost-perf">40%</span>
                        </div>
                        <input type="range" id="cost-perf" min="10" max="80" value="40" step="5">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Slowdown Start Year</span>
                            <span class="control-value" id="val-slowdown-start">2030</span>
                        </div>
                        <input type="range" id="slowdown-start" min="2025" max="2035" value="2030" step="1">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Slowdown Factor</span>
                            <span class="control-value" id="val-slowdown-factor">2x</span>
                        </div>
                        <input type="range" id="slowdown-factor" min="1" max="4" value="2" step="0.5">
                        <div class="info-text">Rate slows by this factor over 5 years</div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">3. Compute Stock</div>
                    <div class="info-text" style="margin-bottom: 10px;">Total active compute from recent years</div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Stock Lifetime (years)</span>
                            <span class="control-value" id="val-stock-lifetime">5</span>
                        </div>
                        <input type="range" id="stock-lifetime" min="2" max="10" value="5" step="1">
                        <div class="info-text">How long compute remains in active use</div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">4. Largest Lab Share</div>
                    <div class="info-text" style="margin-bottom: 10px;">Frontier lab's share of global compute</div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Initial Share (2025)</span>
                            <span class="control-value" id="val-lab-share-init">5%</span>
                        </div>
                        <input type="range" id="lab-share-init" min="1" max="20" value="5" step="1">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Final Share (2030+)</span>
                            <span class="control-value" id="val-lab-share-final">10%</span>
                        </div>
                        <input type="range" id="lab-share-final" min="5" max="40" value="10" step="1">
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">5. Training Run Parameters</div>
                    <div class="info-text" style="margin-bottom: 10px;">Settings for largest training run</div>

                    <div class="param-pair">
                        <div class="param-pair-label">GPU Utilization <span class="param-arrow">2025 → 2030</span></div>
                        <div class="info-text" style="margin-bottom: 8px;">Fraction of peak 8-bit FLOP/s achieved</div>
                        <div class="param-pair-sliders">
                            <div class="param-slider-group">
                                <input type="range" id="utilization" min="5" max="100" value="15" step="5">
                                <span class="control-value" id="val-utilization">15%</span>
                            </div>
                            <span class="param-pair-connector">→</span>
                            <div class="param-slider-group">
                                <input type="range" id="utilization-final" min="5" max="100" value="40" step="5">
                                <span class="control-value" id="val-utilization-final">40%</span>
                            </div>
                        </div>
                    </div>

                    <div class="param-pair">
                        <div class="param-pair-label">Training Run Share <span class="param-arrow">2025 → 2030</span></div>
                        <div class="info-text" style="margin-bottom: 8px;">Share of lab compute for largest run</div>
                        <div class="param-pair-sliders">
                            <div class="param-slider-group">
                                <input type="range" id="training-share" min="1" max="50" value="20" step="1">
                                <span class="control-value" id="val-training-share">20%</span>
                            </div>
                            <span class="param-pair-connector">→</span>
                            <div class="param-slider-group">
                                <input type="range" id="training-share-final" min="1" max="50" value="20" step="1">
                                <span class="control-value" id="val-training-share-final">20%</span>
                            </div>
                        </div>
                    </div>

                    <div class="param-pair">
                        <div class="param-pair-label">Training Duration <span class="param-arrow">2025 → 2030</span></div>
                        <div class="param-pair-sliders">
                            <div class="param-slider-group">
                                <input type="range" id="training-duration" min="30" max="365" value="100" step="10">
                                <span class="control-value" id="val-training-duration">100d</span>
                            </div>
                            <span class="param-pair-connector">→</span>
                            <div class="param-slider-group">
                                <input type="range" id="training-duration-final" min="30" max="365" value="200" step="10">
                                <span class="control-value" id="val-training-duration-final">200d</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="reset-btn" onclick="resetDefaults()">Reset to Defaults</button>
            </div>

            <div class="charts-panel">
                <div class="input-charts-section">
                    <div class="input-charts-title">
                        Input Parameters
                        <span class="drag-hint">Drag points to adjust</span>
                    </div>
                    <div class="input-charts-grid">
                        <div class="input-chart-container">
                            <div class="input-chart-title">Annual Capex ($B)</div>
                            <div class="chart-wrapper input-chart">
                                <canvas id="chart-capex-input"></canvas>
                            </div>
                        </div>
                        <div class="input-chart-container">
                            <div class="input-chart-title">Cost-Performance Improvement (%)</div>
                            <div class="chart-wrapper input-chart">
                                <canvas id="chart-costperf-input"></canvas>
                            </div>
                        </div>
                        <div class="input-chart-container">
                            <div class="input-chart-title">Largest Lab Share (%)</div>
                            <div class="chart-wrapper input-chart">
                                <canvas id="chart-labshare-input"></canvas>
                            </div>
                        </div>
                        <div class="input-chart-container" id="gdp-chart-container">
                            <div class="input-chart-title">GDP Growth Rate (%)</div>
                            <div class="chart-wrapper input-chart">
                                <canvas id="chart-gdp-input"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="toggle-container" style="display: none;">
                    <span class="toggle-label">Log Scale</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="log-scale-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Largest Lab Compute (Million H100-equivalents)</div>
                        <div class="growth-badge" id="growth-badge-frontier" style="background: rgba(0,119,182,0.1); color: #0077b6;">-</div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chart-frontier"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Total Compute Stock (Million H100-equivalents)</div>
                        <div class="growth-badge" id="growth-badge-stock" style="background: rgba(168,85,247,0.1); color: #a855f7;">-</div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chart-stock"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Largest Training Run (FLOP)</div>
                        <div class="growth-badge" id="growth-badge-training" style="background: rgba(220,38,38,0.1); color: #dc2626;">-</div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chart-training"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-table-section">
            <h2 class="stats-title">Key Statistics</h2>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>2030</th>
                        <th>2035</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Largest Training Run</td>
                        <td id="stat-training-2030">-</td>
                        <td id="stat-training-2035">-</td>
                    </tr>
                    <tr>
                        <td>AI Capital Stock Value</td>
                        <td id="stat-capital-2030">-</td>
                        <td id="stat-capital-2035">-</td>
                    </tr>
                    <tr>
                        <td>Lab Annual Compute Spending</td>
                        <td id="stat-lab-spending-2030">-</td>
                        <td id="stat-lab-spending-2035">-</td>
                    </tr>
                    <tr>
                        <td>Total AI Power Capacity</td>
                        <td id="stat-power-total-2030">-</td>
                        <td id="stat-power-total-2035">-</td>
                    </tr>
                    <tr>
                        <td>Largest Training Cluster Power</td>
                        <td id="stat-power-cluster-2030">-</td>
                        <td id="stat-power-cluster-2035">-</td>
                    </tr>
                    <tr>
                        <td>Largest Training Cluster Cost</td>
                        <td id="stat-cluster-cost-2030">-</td>
                        <td id="stat-cluster-cost-2035">-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="assumptions-section">
            <h3 class="assumptions-title">Model Assumptions</h3>
            <ul class="assumptions-list">
                <li><strong>2025 baseline:</strong> $500B annual AI capex, 10M H100-equivalent compute stock, 10M H100-equiv prior stock</li>
                <li><strong>Compute per dollar:</strong> $500B buys 10M H100-equivalents in 2025 (i.e., $50K per H100-equiv), improving annually by cost-performance rate</li>
                <li><strong>H100 peak performance:</strong> 2,000 TFLOP/s (8-bit operations), i.e., 2×10<sup>15</sup> FLOP/s per GPU</li>
                <li><strong>Power capacity:</strong> $40B capex = 1 GW power capacity</li>
                <li><strong>Capital stock value:</strong> Sum of capex over stock lifetime years (no depreciation within lifetime)</li>
                <li><strong>Training run timing:</strong> Training run uses compute available at start of run (duration days before completion)</li>
                <li><strong>Lab share growth:</strong> Exponential interpolation from initial to final share (2025→2030), then constant</li>
                <li><strong>Training parameters:</strong> Linear interpolation from 2025 to 2030 values, then constant after 2030</li>
            </ul>
        </div>
    </div>

    <script>
        // Chart instances
        let chartFrontier, chartStock, chartTraining;
        let chartCapexInput, chartCostPerfInput, chartLabShareInput;

        // Custom chart data (when dragged to values not achievable via sliders)
        let customCapexData = null;
        let customCostPerfData = null;
        let customLabShareData = null;
        let customGdpGrowthData = null;

        // GDP chart instance
        let chartGdpGrowthInput;

        // Default values
        const defaults = {
            capexGrowth: 40,
            capexGdpPercent: 1,
            gdpGrowth2035: 3,
            costPerf: 40,
            slowdownStart: 2030,
            slowdownFactor: 2,
            stockLifetime: 5,
            labShareInit: 5,
            labShareFinal: 10,
            utilization: 15,
            utilizationFinal: 40,
            trainingShare: 20,
            trainingShareFinal: 20,
            trainingDuration: 100,
            trainingDurationFinal: 200
        };

        // World GDP in 2025 ($T)
        const INITIAL_GDP = 120; // $120T

        // H100 specs: 2000 TFLOP/s peak 8-bit = 2e15 FLOP/s
        const H100_PEAK_FLOPS = 2e15; // FLOP/s per H100 (8-bit)

        // Log scale state
        let useLogScale = true;

        // Initial conditions (2025)
        const INITIAL_CAPEX = 500; // $500B in 2025
        const COMPUTE_PER_DOLLAR_2025 = 10 / 500; // 10M H100-equiv per $500B = 0.02 M per $B

        const years = [2025, 2026, 2027, 2028, 2029, 2030, 2031, 2032, 2033, 2034, 2035];

        function getParams() {
            return {
                // Capex params
                capexGrowth: parseFloat(document.getElementById('capex-growth').value) / 100,
                capexGdpPercent: parseFloat(document.getElementById('capex-gdp-percent').value) / 100,
                gdpGrowth2035: parseFloat(document.getElementById('gdp-growth-2035').value) / 100,
                // Other params
                costPerf: parseFloat(document.getElementById('cost-perf').value) / 100,
                slowdownStart: parseInt(document.getElementById('slowdown-start').value),
                slowdownFactor: parseFloat(document.getElementById('slowdown-factor').value),
                stockLifetime: parseInt(document.getElementById('stock-lifetime').value),
                labShareInit: parseFloat(document.getElementById('lab-share-init').value) / 100,
                labShareFinal: parseFloat(document.getElementById('lab-share-final').value) / 100,
                utilization: parseFloat(document.getElementById('utilization').value) / 100,
                utilizationFinal: parseFloat(document.getElementById('utilization-final').value) / 100,
                trainingShare: parseFloat(document.getElementById('training-share').value) / 100,
                trainingShareFinal: parseFloat(document.getElementById('training-share-final').value) / 100,
                trainingDuration: parseInt(document.getElementById('training-duration').value),
                trainingDurationFinal: parseInt(document.getElementById('training-duration-final').value)
            };
        }

        function generateGdpGrowthData(params) {
            // Generate GDP growth rates with exponential interpolation from 3% in 2025 to target in 2035
            const gdpGrowth2025 = 0.03; // Fixed at 3%
            const data = [];
            for (let i = 0; i < years.length; i++) {
                const year = years[i];
                let growthRate;
                if (year <= 2025) {
                    growthRate = gdpGrowth2025 * 100;
                } else {
                    // Exponential interpolation from 2025 to 2035
                    const progress = (year - 2025) / 10;
                    growthRate = gdpGrowth2025 * 100 * Math.pow(params.gdpGrowth2035 / gdpGrowth2025, progress);
                }
                data.push(growthRate);
            }
            return data;
        }

        function generateGdpData(params) {
            // Generate world GDP based on growth rates
            const gdpGrowthData = customGdpGrowthData || generateGdpGrowthData(params);
            const data = [];
            for (let i = 0; i < years.length; i++) {
                if (i === 0) {
                    data.push(INITIAL_GDP * 1000); // Convert to $B for consistency
                } else {
                    data.push(data[i-1] * (1 + gdpGrowthData[i-1] / 100));
                }
            }
            return data;
        }

        function generateCapexData(params) {
            const data = [];
            const gdpData = generateGdpData(params);

            for (let i = 0; i < years.length; i++) {
                if (i === 0) {
                    data.push(INITIAL_CAPEX);
                } else {
                    // Constant growth rate until hitting cap
                    const projectedCapex = data[i-1] * (1 + params.capexGrowth);
                    const capexCap = gdpData[i] * params.capexGdpPercent;
                    data.push(Math.min(projectedCapex, capexCap));
                }
            }
            return data;
        }

        function generateCostPerfData(params) {
            // Cost-perf rate stays constant until slowdownStart, then decays exponentially
            // from initial rate to initial/slowdownFactor over 5 years
            const data = [];
            const initialRate = params.costPerf * 100;
            const finalRate = initialRate / params.slowdownFactor;
            const decayYears = 5; // Fixed 5-year decay period

            for (let i = 0; i < years.length; i++) {
                const year = years[i];
                let rate;
                if (year <= params.slowdownStart) {
                    rate = initialRate;
                } else if (year >= params.slowdownStart + decayYears) {
                    rate = finalRate;
                } else {
                    // Exponential decay from initial to final over 5 years starting at slowdownStart
                    const progress = (year - params.slowdownStart) / decayYears;
                    rate = initialRate * Math.pow(finalRate / initialRate, progress);
                }
                data.push(rate);
            }
            return data;
        }

        function generateLabShareData(params) {
            const data = [];
            for (let i = 0; i < years.length; i++) {
                const year = years[i];
                let share;
                if (year >= 2030) {
                    share = params.labShareFinal * 100;
                } else {
                    const progress = (year - 2025) / 5;
                    share = params.labShareInit * 100 * Math.pow(params.labShareFinal / params.labShareInit, progress);
                }
                data.push(share);
            }
            return data;
        }

        function simulate() {
            const params = getParams();
            const capexData = customCapexData || generateCapexData(params);
            const costPerfData = customCostPerfData || generateCostPerfData(params);
            const labShareData = customLabShareData || generateLabShareData(params);

            const annualComputeData = [];
            const stockData = [];
            const frontierComputeData = [];
            const annualShipments = [];
            const pre2025Shipments = [10];

            for (let i = 0; i < years.length; i++) {
                const year = years[i];
                const t = i;

                // Calculate compute per dollar (cumulative improvement)
                let computePerDollar = COMPUTE_PER_DOLLAR_2025;
                for (let j = 0; j < i; j++) {
                    computePerDollar *= (1 + costPerfData[j] / 100);
                }

                // Annual compute shipment
                const annualCompute = capexData[i] * computePerDollar;
                annualComputeData.push(annualCompute);
                annualShipments.push(annualCompute);

                // Calculate total stock (rolling window)
                let stock = 0;
                for (let j = 0; j < pre2025Shipments.length; j++) {
                    const shipmentAge = t + 1 + j;
                    if (shipmentAge <= params.stockLifetime) {
                        stock += pre2025Shipments[j];
                    }
                }
                for (let j = 0; j <= t; j++) {
                    const shipmentAge = t - j + 1;
                    if (shipmentAge <= params.stockLifetime) {
                        stock += annualShipments[j];
                    }
                }
                stockData.push(stock);

                // Frontier lab compute
                const frontierCompute = stock * (labShareData[i] / 100);
                frontierComputeData.push(frontierCompute);
            }

            // Calculate largest training run FLOP
            // Training run uses compute from (duration) days ago
            // Parameters interpolate from 2025 to 2030 values
            const trainingRunData = [];
            const secondsPerDay = 86400;

            for (let i = 0; i < years.length; i++) {
                const year = years[i];

                // Interpolate training params from 2025 to 2030, then hold constant
                const progress = Math.min(1, (year - 2025) / 5);
                const utilization = params.utilization + (params.utilizationFinal - params.utilization) * progress;
                const trainingShare = params.trainingShare + (params.trainingShareFinal - params.trainingShare) * progress;
                const durationDays = params.trainingDuration + (params.trainingDurationFinal - params.trainingDuration) * progress;
                const durationYears = durationDays / 365;

                // Get lab compute at start of training (duration days before this year end)
                // For simplicity, interpolate between years
                const effectiveYearIndex = Math.max(0, i - durationYears);
                const lowerIdx = Math.floor(effectiveYearIndex);
                const upperIdx = Math.min(years.length - 1, Math.ceil(effectiveYearIndex));
                const frac = effectiveYearIndex - lowerIdx;

                let labComputeAtStart;
                if (lowerIdx === upperIdx) {
                    labComputeAtStart = frontierComputeData[lowerIdx];
                } else {
                    labComputeAtStart = frontierComputeData[lowerIdx] * (1 - frac) + frontierComputeData[upperIdx] * frac;
                }

                // Training compute = lab compute * training share
                const trainingComputeH100 = labComputeAtStart * trainingShare * 1e6; // Convert M to actual count

                // FLOP = H100s * utilization * peak FLOP/s * duration in seconds
                const trainingFlop = trainingComputeH100 * utilization * H100_PEAK_FLOPS * durationDays * secondsPerDay;
                trainingRunData.push(trainingFlop);
            }

            // Calculate capital stock value (sum of capex over lifetime years)
            const capitalStockValue = [];
            for (let i = 0; i < years.length; i++) {
                let totalCapex = 0;
                for (let j = Math.max(0, i - params.stockLifetime + 1); j <= i; j++) {
                    totalCapex += capexData[j];
                }
                // Add pre-2025 capex contribution (roughly $500B worth still active in early years)
                if (i < params.stockLifetime) {
                    totalCapex += 500 * Math.max(0, params.stockLifetime - i - 1);
                }
                capitalStockValue.push(totalCapex);
            }

            // Calculate training share data for each year (interpolated)
            const trainingShareData = [];
            for (let i = 0; i < years.length; i++) {
                const year = years[i];
                const progress = Math.min(1, (year - 2025) / 5);
                const trainingShare = params.trainingShare + (params.trainingShareFinal - params.trainingShare) * progress;
                trainingShareData.push(trainingShare);
            }

            // Generate GDP growth data for chart
            const gdpGrowthData = customGdpGrowthData || generateGdpGrowthData(params);

            return {
                years,
                capexData,
                costPerfData,
                stockData,
                labShareData,
                frontierComputeData,
                trainingRunData,
                capitalStockValue,
                trainingShareData,
                gdpGrowthData
            };
        }

        function calculateCAGR(startVal, endVal, years) {
            return (Math.pow(endVal / startVal, 1 / years) - 1) * 100;
        }

        function updateCharts() {
            const data = simulate();

            // Update metrics
            const frontier2030 = data.frontierComputeData[5];
            const frontier2035 = data.frontierComputeData[10];
            const frontier2025 = data.frontierComputeData[0];

            // Calculate values for metric cards - 2030
            const params = getParams();
            const DOLLARS_PER_GW = 40;
            const capital2030 = data.capitalStockValue[5];
            const labShare2030 = data.labShareData[5] / 100;
            const trainingShare2030 = data.trainingShareData[5];
            const labCapital2030 = capital2030 * labShare2030;
            const labSpend2030 = labCapital2030 / params.stockLifetime;
            const clusterCost2030 = labCapital2030 * trainingShare2030;
            const powerTotal2030 = capital2030 / DOLLARS_PER_GW;

            // Calculate values for metric cards - 2035
            const capital2035 = data.capitalStockValue[10];
            const labShare2035 = data.labShareData[10] / 100;
            const trainingShare2035 = data.trainingShareData[10];
            const labCapital2035 = capital2035 * labShare2035;
            const labSpend2035 = labCapital2035 / params.stockLifetime;
            const clusterCost2035 = labCapital2035 * trainingShare2035;
            const powerTotal2035 = capital2035 / DOLLARS_PER_GW;

            // Update 2030 metrics
            document.getElementById('metric-training-2030').textContent = formatFlop(data.trainingRunData[5]);
            document.getElementById('metric-cluster-cost-2030').textContent = formatDollars(clusterCost2030);
            document.getElementById('metric-power-2030').textContent = formatPower(powerTotal2030);

            // Update 2035 metrics
            document.getElementById('metric-training-2035').textContent = formatFlop(data.trainingRunData[10]);
            document.getElementById('metric-cluster-cost-2035').textContent = formatDollars(clusterCost2035);
            document.getElementById('metric-power-2035').textContent = formatPower(powerTotal2035);

            // Calculate and display annual growth multipliers (geometric mean)
            const frontier2030AnnualGrowth = Math.pow(frontier2030 / frontier2025, 1/5);
            const frontier2035AnnualGrowth = Math.pow(frontier2035 / frontier2025, 1/10);
            const stock2030AnnualGrowth = Math.pow(data.stockData[5] / data.stockData[0], 1/5);
            const stock2035AnnualGrowth = Math.pow(data.stockData[10] / data.stockData[0], 1/10);

            document.getElementById('growth-badge-frontier').textContent = `${formatGrowth(frontier2030AnnualGrowth)}/yr to 2030, ${formatGrowth(frontier2035AnnualGrowth)}/yr to 2035`;
            document.getElementById('growth-badge-stock').textContent = `${formatGrowth(stock2030AnnualGrowth)}/yr to 2030, ${formatGrowth(stock2035AnnualGrowth)}/yr to 2035`;

            // Update input charts
            chartCapexInput.data.datasets[0].data = data.capexData;
            chartCapexInput.update('none');

            chartCostPerfInput.data.datasets[0].data = data.costPerfData;
            chartCostPerfInput.update('none');

            chartLabShareInput.data.datasets[0].data = data.labShareData;
            chartLabShareInput.update('none');

            // Update GDP growth chart
            chartGdpGrowthInput.data.datasets[0].data = data.gdpGrowthData;
            chartGdpGrowthInput.update('none');

            // Update output charts with growth annotations
            chartFrontier.data.datasets[0].data = data.frontierComputeData;
            updateGrowthAnnotations(chartFrontier, data.frontierComputeData);
            chartFrontier.update('none');

            chartStock.data.datasets[0].data = data.stockData;
            updateGrowthAnnotations(chartStock, data.stockData);
            chartStock.update('none');

            // Update training run chart
            chartTraining.data.datasets[0].data = data.trainingRunData;
            updateGrowthAnnotations(chartTraining, data.trainingRunData);
            chartTraining.update('none');

            // Training run annual growth multipliers (geometric mean)
            const training2030AnnualGrowth = Math.pow(data.trainingRunData[5] / data.trainingRunData[0], 1/5);
            const training2035AnnualGrowth = Math.pow(data.trainingRunData[10] / data.trainingRunData[0], 1/10);
            document.getElementById('growth-badge-training').textContent = `${formatGrowth(training2030AnnualGrowth)}/yr to 2030, ${formatGrowth(training2035AnnualGrowth)}/yr to 2035`;

            // Update stats table
            updateStatsTable(data);
        }

        function updateStatsTable(data) {
            // Constants
            const DOLLARS_PER_GW = 40; // $40B = 1 GW

            // Index 5 = 2030, Index 10 = 2035
            const idx2030 = 5;
            const idx2035 = 10;

            // Largest Training Run (FLOP)
            document.getElementById('stat-training-2030').textContent = formatFlop(data.trainingRunData[idx2030]) + ' FLOP';
            document.getElementById('stat-training-2035').textContent = formatFlop(data.trainingRunData[idx2035]) + ' FLOP';

            // AI Capital Stock Value (sum of recent capex)
            const capital2030 = data.capitalStockValue[idx2030];
            const capital2035 = data.capitalStockValue[idx2035];
            document.getElementById('stat-capital-2030').textContent = formatDollars(capital2030);
            document.getElementById('stat-capital-2035').textContent = formatDollars(capital2035);

            // Lab Annual Compute Spending = lab's share of capital stock / stock lifetime (annual depreciation)
            const params = getParams();
            const labShare2030 = data.labShareData[idx2030] / 100;
            const labShare2035 = data.labShareData[idx2035] / 100;
            const labCapital2030 = capital2030 * labShare2030;
            const labCapital2035 = capital2035 * labShare2035;
            const labAnnualSpend2030 = labCapital2030 / params.stockLifetime;
            const labAnnualSpend2035 = labCapital2035 / params.stockLifetime;
            document.getElementById('stat-lab-spending-2030').textContent = formatDollars(labAnnualSpend2030);
            document.getElementById('stat-lab-spending-2035').textContent = formatDollars(labAnnualSpend2035);

            // Total AI Power Capacity (capital stock / $50B per GW)
            const powerTotal2030 = capital2030 / DOLLARS_PER_GW;
            const powerTotal2035 = capital2035 / DOLLARS_PER_GW;
            document.getElementById('stat-power-total-2030').textContent = formatPower(powerTotal2030);
            document.getElementById('stat-power-total-2035').textContent = formatPower(powerTotal2035);

            // Largest Training Cluster Power = training share * lab share * total power
            const trainingShare2030 = data.trainingShareData[idx2030];
            const trainingShare2035 = data.trainingShareData[idx2035];
            const clusterPower2030 = powerTotal2030 * labShare2030 * trainingShare2030;
            const clusterPower2035 = powerTotal2035 * labShare2035 * trainingShare2035;
            document.getElementById('stat-power-cluster-2030').textContent = formatPower(clusterPower2030);
            document.getElementById('stat-power-cluster-2035').textContent = formatPower(clusterPower2035);

            // Largest Training Cluster Cost = capital cost of lab's training cluster
            const clusterCost2030 = labCapital2030 * trainingShare2030;
            const clusterCost2035 = labCapital2035 * trainingShare2035;
            document.getElementById('stat-cluster-cost-2030').textContent = formatDollars(clusterCost2030);
            document.getElementById('stat-cluster-cost-2035').textContent = formatDollars(clusterCost2035);
        }

        function formatDollars(billions) {
            if (billions >= 1000) {
                return '$' + (billions / 1000).toFixed(1) + 'T';
            } else {
                return '$' + billions.toFixed(0) + 'B';
            }
        }

        function formatPower(gw) {
            if (gw >= 1000) {
                return (gw / 1000).toFixed(1) + ' TW';
            } else if (gw >= 1) {
                return gw.toFixed(1) + ' GW';
            } else {
                return (gw * 1000).toFixed(0) + ' MW';
            }
        }

        function updateGrowthAnnotations(chart, data) {
            // Calculate year-over-year growth rates and add as annotations
            const annotations = {};

            // Add growth rate labels at key points (2027, 2030, 2033)
            [2, 5, 8].forEach((idx, i) => {
                if (idx > 0 && data[idx] && data[idx-1]) {
                    const yoyGrowth = ((data[idx] / data[idx-1]) - 1) * 100;
                    annotations[`growth${i}`] = {
                        type: 'label',
                        xValue: years[idx],
                        yValue: data[idx],
                        content: `+${yoyGrowth.toFixed(0)}%/yr`,
                        font: { size: 10, weight: 'bold' },
                        color: '#666',
                        position: 'end',
                        yAdjust: -15
                    };
                }
            });

            chart.options.plugins.annotation.annotations = annotations;
        }

        function updateScaleType() {
            const scaleType = useLogScale ? 'logarithmic' : 'linear';

            // Update each chart's scale type individually
            [chartFrontier, chartStock, chartTraining].forEach(chart => {
                // Replace the entire y scale configuration
                chart.options.scales.y = {
                    type: scaleType,
                    grid: { color: 'rgba(0,0,0,0.05)' },
                    ticks: { color: '#666' }
                };

                // Force chart to fully reset and rebuild scales
                chart.update();
            });
        }

        function formatNumber(num) {
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'B';
            } else if (num >= 1) {
                return num.toFixed(0) + 'M';
            } else {
                return (num * 1000).toFixed(0) + 'K';
            }
        }

        function formatFlop(flop) {
            // Format FLOP in proper scientific notation
            if (flop <= 0) return '0';
            const exponent = Math.floor(Math.log10(flop));
            const mantissa = flop / Math.pow(10, exponent);
            return mantissa.toFixed(1) + 'e' + exponent;
        }

        function formatGrowth(multiplier) {
            // Format growth multiplier nicely
            if (multiplier >= 1000) {
                return (multiplier / 1000).toFixed(1) + 'Kx';
            } else if (multiplier >= 100) {
                return Math.round(multiplier) + 'x';
            } else if (multiplier >= 10) {
                return multiplier.toFixed(0) + 'x';
            } else {
                return multiplier.toFixed(1) + 'x';
            }
        }

        function updateLabels() {
            // Capex params
            document.getElementById('val-capex-growth').textContent = document.getElementById('capex-growth').value + '%';
            document.getElementById('val-capex-gdp-percent').textContent = document.getElementById('capex-gdp-percent').value + '%';
            document.getElementById('val-gdp-growth-2035').textContent = document.getElementById('gdp-growth-2035').value + '%';
            // Other params
            document.getElementById('val-cost-perf').textContent = document.getElementById('cost-perf').value + '%';
            document.getElementById('val-slowdown-start').textContent = document.getElementById('slowdown-start').value;
            document.getElementById('val-slowdown-factor').textContent = document.getElementById('slowdown-factor').value + 'x';
            document.getElementById('val-stock-lifetime').textContent = document.getElementById('stock-lifetime').value;
            document.getElementById('val-lab-share-init').textContent = document.getElementById('lab-share-init').value + '%';
            document.getElementById('val-lab-share-final').textContent = document.getElementById('lab-share-final').value + '%';
            document.getElementById('val-utilization').textContent = document.getElementById('utilization').value + '%';
            document.getElementById('val-utilization-final').textContent = document.getElementById('utilization-final').value + '%';
            document.getElementById('val-training-share').textContent = document.getElementById('training-share').value + '%';
            document.getElementById('val-training-share-final').textContent = document.getElementById('training-share-final').value + '%';
            document.getElementById('val-training-duration').textContent = document.getElementById('training-duration').value + 'd';
            document.getElementById('val-training-duration-final').textContent = document.getElementById('training-duration-final').value + 'd';
        }

        function resetDefaults() {
            // Clear any custom chart data
            customCapexData = null;
            customCostPerfData = null;
            customLabShareData = null;
            customGdpGrowthData = null;
            updateCustomIndicators();

            // Capex params
            document.getElementById('capex-growth').value = defaults.capexGrowth;
            document.getElementById('capex-gdp-percent').value = defaults.capexGdpPercent;
            document.getElementById('gdp-growth-2035').value = defaults.gdpGrowth2035;
            // Other params
            document.getElementById('cost-perf').value = defaults.costPerf;
            document.getElementById('slowdown-start').value = defaults.slowdownStart;
            document.getElementById('slowdown-factor').value = defaults.slowdownFactor;
            document.getElementById('stock-lifetime').value = defaults.stockLifetime;
            document.getElementById('lab-share-init').value = defaults.labShareInit;
            document.getElementById('lab-share-final').value = defaults.labShareFinal;
            document.getElementById('utilization').value = defaults.utilization;
            document.getElementById('utilization-final').value = defaults.utilizationFinal;
            document.getElementById('training-share').value = defaults.trainingShare;
            document.getElementById('training-share-final').value = defaults.trainingShareFinal;
            document.getElementById('training-duration').value = defaults.trainingDuration;
            document.getElementById('training-duration-final').value = defaults.trainingDurationFinal;
            updateLabels();
            updateCharts();
        }

        function initCharts() {
            const inputChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: { display: false },
                    dragData: {
                        round: 1,
                        showTooltip: true,
                        onDragEnd: function(e, datasetIndex, index, value) {
                            syncFromChart(e.target.canvas.id, index, value);
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: { color: '#666', font: { size: 10 } }
                    },
                    y: {
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: { color: '#666', font: { size: 10 } }
                    }
                }
            };

            const outputChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: { display: false },
                    annotation: { annotations: {} }
                },
                scales: {
                    x: {
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: { color: '#666' }
                    },
                    y: {
                        type: 'logarithmic',
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: { color: '#666' },
                        afterDataLimits: (scale) => {
                            // Set reasonable bounds based on actual data
                            const data = scale.chart.data.datasets[0].data;
                            if (data && data.length > 0) {
                                const minVal = Math.min(...data.filter(v => v > 0));
                                const maxVal = Math.max(...data);
                                scale.min = minVal * 0.5;
                                scale.max = maxVal * 2;
                            }
                        }
                    }
                }
            };

            // Capex input chart
            chartCapexInput = new Chart(document.getElementById('chart-capex-input'), {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Capex ($B)',
                        data: [],
                        borderColor: '#e63946',
                        backgroundColor: 'rgba(230, 57, 70, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#e63946',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    ...inputChartOptions,
                    plugins: {
                        ...inputChartOptions.plugins,
                        dragData: {
                            round: 0,
                            showTooltip: true,
                            dragX: false,
                            onDragEnd: function(e, datasetIndex, index, value) {
                                syncCapexFromChart(index, value);
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `$${Math.round(ctx.parsed.y)}B`
                            }
                        }
                    },
                    scales: {
                        ...inputChartOptions.scales,
                        y: {
                            ...inputChartOptions.scales.y,
                            min: 0,
                            afterDataLimits: (scale) => {
                                const data = scale.chart.data.datasets[0].data;
                                if (data && data.length > 0) {
                                    const maxVal = Math.max(...data);
                                    scale.max = Math.max(5000, maxVal * 1.2);
                                }
                            }
                        }
                    }
                }
            });

            // Cost-perf input chart
            chartCostPerfInput = new Chart(document.getElementById('chart-costperf-input'), {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Cost-Perf (%)',
                        data: [],
                        borderColor: '#2a9d8f',
                        backgroundColor: 'rgba(42, 157, 143, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#2a9d8f',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    ...inputChartOptions,
                    plugins: {
                        ...inputChartOptions.plugins,
                        dragData: {
                            round: 1,
                            showTooltip: true,
                            dragX: false,
                            onDragEnd: function(e, datasetIndex, index, value) {
                                syncCostPerfFromChart(index, value);
                            }
                        }
                    },
                    scales: {
                        ...inputChartOptions.scales,
                        y: {
                            ...inputChartOptions.scales.y,
                            min: 0,
                            afterDataLimits: (scale) => {
                                const data = scale.chart.data.datasets[0].data;
                                if (data && data.length > 0) {
                                    const maxVal = Math.max(...data);
                                    scale.max = Math.max(80, maxVal * 1.2);
                                }
                            }
                        }
                    }
                }
            });

            // Lab share input chart
            chartLabShareInput = new Chart(document.getElementById('chart-labshare-input'), {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Lab Share (%)',
                        data: [],
                        borderColor: '#f4a261',
                        backgroundColor: 'rgba(244, 162, 97, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#f4a261',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    ...inputChartOptions,
                    plugins: {
                        ...inputChartOptions.plugins,
                        dragData: {
                            round: 1,
                            showTooltip: true,
                            dragX: false,
                            onDragEnd: function(e, datasetIndex, index, value) {
                                syncLabShareFromChart(index, value);
                            }
                        }
                    },
                    scales: {
                        ...inputChartOptions.scales,
                        y: {
                            ...inputChartOptions.scales.y,
                            min: 0,
                            afterDataLimits: (scale) => {
                                const data = scale.chart.data.datasets[0].data;
                                if (data && data.length > 0) {
                                    const maxVal = Math.max(...data);
                                    scale.max = Math.max(40, maxVal * 1.2);
                                }
                            }
                        }
                    }
                }
            });

            // GDP growth input chart
            chartGdpGrowthInput = new Chart(document.getElementById('chart-gdp-input'), {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'GDP Growth (%)',
                        data: [],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#6366f1',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    ...inputChartOptions,
                    plugins: {
                        ...inputChartOptions.plugins,
                        dragData: {
                            round: 1,
                            showTooltip: true,
                            dragX: false,
                            onDragEnd: function(e, datasetIndex, index, value) {
                                syncGdpGrowthFromChart(index, value);
                            }
                        }
                    },
                    scales: {
                        ...inputChartOptions.scales,
                        y: {
                            ...inputChartOptions.scales.y,
                            min: 0,
                            afterDataLimits: (scale) => {
                                const data = scale.chart.data.datasets[0].data;
                                if (data && data.length > 0) {
                                    const maxVal = Math.max(...data);
                                    scale.max = Math.max(10, maxVal * 1.2);
                                }
                            }
                        }
                    }
                }
            });

            // Frontier compute output chart
            chartFrontier = new Chart(document.getElementById('chart-frontier'), {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Largest Lab Compute',
                        data: [],
                        borderColor: '#0077b6',
                        backgroundColor: 'rgba(0, 119, 182, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    ...outputChartOptions,
                    plugins: {
                        ...outputChartOptions.plugins,
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${formatNumber(ctx.parsed.y)} H100-equiv`
                            }
                        }
                    }
                }
            });

            // Stock output chart
            chartStock = new Chart(document.getElementById('chart-stock'), {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Total Compute Stock',
                        data: [],
                        borderColor: '#a855f7',
                        backgroundColor: 'rgba(168, 85, 247, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    ...outputChartOptions,
                    plugins: {
                        ...outputChartOptions.plugins,
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${formatNumber(ctx.parsed.y)} H100-equiv`
                            }
                        }
                    }
                }
            });

            // Training run output chart
            chartTraining = new Chart(document.getElementById('chart-training'), {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Largest Training Run',
                        data: [],
                        borderColor: '#dc2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    ...outputChartOptions,
                    plugins: {
                        ...outputChartOptions.plugins,
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${formatFlop(ctx.parsed.y)} FLOP`
                            }
                        }
                    }
                }
            });
        }

        // Sync functions for draggable charts - store custom data
        function syncCapexFromChart(index, value) {
            // Store the current chart data as custom data
            customCapexData = [...chartCapexInput.data.datasets[0].data];
            customCapexData[index] = Math.max(100, value); // Minimum $100B
            updateCustomIndicators();
            updateCharts();
        }

        function syncCostPerfFromChart(index, value) {
            // Store the current chart data as custom data
            customCostPerfData = [...chartCostPerfInput.data.datasets[0].data];
            customCostPerfData[index] = Math.max(0, Math.min(80, value));
            updateCustomIndicators();
            updateCharts();
        }

        function syncLabShareFromChart(index, value) {
            // Store the current chart data as custom data
            customLabShareData = [...chartLabShareInput.data.datasets[0].data];
            customLabShareData[index] = Math.max(1, Math.min(50, value));
            updateCustomIndicators();
            updateCharts();
        }

        function syncGdpGrowthFromChart(index, value) {
            // Store the current chart data as custom data
            customGdpGrowthData = [...chartGdpGrowthInput.data.datasets[0].data];
            customGdpGrowthData[index] = Math.max(0.5, Math.min(10, value));
            updateCustomIndicators();
            updateCharts();
        }

        function updateCustomIndicators() {
            // Update visual indicators for custom mode
            const capexContainer = document.querySelector('#chart-capex-input').closest('.input-chart-container');
            const costPerfContainer = document.querySelector('#chart-costperf-input').closest('.input-chart-container');
            const labShareContainer = document.querySelector('#chart-labshare-input').closest('.input-chart-container');
            const gdpContainer = document.querySelector('#chart-gdp-input').closest('.input-chart-container');

            updateContainerIndicator(capexContainer, customCapexData, 'capex');
            updateContainerIndicator(costPerfContainer, customCostPerfData, 'costperf');
            updateContainerIndicator(labShareContainer, customLabShareData, 'labshare');
            updateContainerIndicator(gdpContainer, customGdpGrowthData, 'gdpgrowth');

            // Gray out corresponding slider sections when in custom mode
            document.querySelector('#capex-growth').closest('.section').classList.toggle('custom-mode', !!customCapexData);
            document.querySelector('#cost-perf').closest('.section').classList.toggle('custom-mode', !!customCostPerfData);
            document.querySelector('#lab-share-init').closest('.section').classList.toggle('custom-mode', !!customLabShareData);
        }

        function updateContainerIndicator(container, customData, type) {
            let indicator = container.querySelector('.custom-indicator');
            if (customData) {
                if (!indicator) {
                    indicator = document.createElement('div');
                    indicator.className = 'custom-indicator';
                    indicator.innerHTML = '<span>Custom</span><button class="reset-custom-btn" onclick="resetCustomData(\'' + type + '\')">Reset</button>';
                    container.querySelector('.input-chart-title').appendChild(indicator);
                }
            } else if (indicator) {
                indicator.remove();
            }
        }

        function resetCustomData(type) {
            if (type === 'capex') {
                customCapexData = null;
            } else if (type === 'costperf') {
                customCostPerfData = null;
            } else if (type === 'labshare') {
                customLabShareData = null;
            } else if (type === 'gdpgrowth') {
                customGdpGrowthData = null;
            }
            updateCustomIndicators();
            updateCharts();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            updateLabels();
            updateCharts();

            // Add event listeners to all sliders
            const sliders = document.querySelectorAll('input[type="range"]');
            sliders.forEach(slider => {
                slider.addEventListener('input', () => {
                    updateLabels();
                    updateCharts();
                });
            });

            // Add event listener for log scale toggle
            document.getElementById('log-scale-toggle').addEventListener('change', (e) => {
                useLogScale = e.target.checked;
                updateScaleType();
            });
        });
    </script>
</body>
</html>
